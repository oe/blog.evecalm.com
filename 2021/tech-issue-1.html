<!DOCTYPE html><html lang="zh-Hans" class="scroll-smooth"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.png" type="image/png"><title>Tech Issue #1 - 夏影の博客</title><link rel="alternate" type="application/rss+xml" title="夏影の博客" href="https://blog.evecalm.com/atom.xml"><meta name="description" content="因日常工作忙碌、个人时间太少, 故我将日常工作遇到的问题、上网学到的知识记录下来, 形成下面这样技术类的笔记, 希望能通过这种方式, 能每周能有所记录分享. 开发问题 在 Nodejs 中发起HTTP请求遇到 unable to verify the first certificate错误 近期有用户反馈： 同一个API接口，在浏览器、安卓客户端、iOS客户端、小程序里都能正常调用，但是在Node..."><meta property="og:type" content="blog"><meta property="og:title" content="Tech Issue #1"><meta property="og:url" content="https://blog.evecalm.com/2021/tech-issue-1.html"><meta property="og:site_name" content="夏影の博客"><meta property="og:local" content="zh-Hans"><meta property="og:description" content="因日常工作忙碌、个人时间太少, 故我将日常工作遇到的问题、上网学到的知识记录下来, 形成下面这样技术类的笔记, 希望能通过这种方式, 能每周能有所记录分享. 开发问题 在 Nodejs 中发起HTTP请求遇到 unable to verify the first certificate错误 近期有用户反馈： 同一个API接口，在浏览器、安卓客户端、iOS客户端、小程序里都能正常调用，但是在Node..."><meta property="og:image" content="//evecalm.com/assets/avatar.jpg"><meta property="article:author" content="Saiya"><link rel="canonical" href="https://blog.evecalm.com/2021/tech-issue-1.html"><link rel="stylesheet" href="/_astro/_pageList_.rVnnU10n.css">
<style>@charset "UTF-8";article h1,article h2,article h3,article h4,article h5,article h6{position:relative}article h1 .icon-link,article h2 .icon-link,article h3 .icon-link,article h4 .icon-link,article h5 .icon-link,article h6 .icon-link{position:absolute;left:-1em;opacity:0}article h1 .icon-link:after,article h2 .icon-link:after,article h3 .icon-link:after,article h4 .icon-link:after,article h5 .icon-link:after,article h6 .icon-link:after{content:"🔗";font-size:.6em}article h1:hover .icon-link,article h2:hover .icon-link,article h3:hover .icon-link,article h4:hover .icon-link,article h5:hover .icon-link,article h6:hover .icon-link{opacity:1}.post-title{margin-bottom:.2em}
.hover-tip{position:relative;&:before{content:attr(aria-label);position:absolute;bottom:120%;left:50%;width:-moz-max-content;width:max-content;transform:translate(-50%);padding:.5rem;background-color:#333;color:#ddd;border-radius:.25rem;box-shadow:0 0 .5rem #0000001a;z-index:10;display:none}&.bottom:before{top:120%;bottom:auto}&:hover:before{display:block}}
</style></head> <body class="bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-300 font-sans text-wrap break-words relative"> <div class="border-b border-slate-100 dark:border-slate-700 mb-4"> <header class="max-w-4xl flex justify-between items-center m-auto py-6 px-4 font-serif text-slate-500 dark:text-slate-400 max-xs:flex-col max-xs:gap-2"> <h1 class="text-xl"> <a href="/">夏影の博客</a> </h1> <ul class="flex gap-4"> <li> <a href="/categories/">分类</a> </li> <li> <a href="/tags/">标签</a> </li> <li> <a href="https://evecalm.com/about" target="_blank">关于</a> </li> <li> <a href="/atom.xml" target="_blank" aria-label="RSS 订阅" class="hover-tip bottom"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg> </a> </li> <li> <a href="https://github.com/oe" target="_blank" aria-label="Github 账户" class="hover-tip bottom"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> </a> </li> </ul> </header> </div>   <article class="format lg:format-lg max-w-4xl prose-zinc dark:format-invert mx-auto px-4 mb-4"> <h1 class="post-title">Tech Issue #1</h1> <div class="text-slate-400 text-sm mb-2">2021年12月25日<!-- -->发布在 <a href="/categories/Tech-Issue/">Tech-Issue</a></div> <p>因日常工作忙碌、个人时间太少, 故我将日常工作遇到的问题、上网学到的知识记录下来, 形成下面这样技术类的笔记, 希望能通过这种方式, 能每周能有所记录分享.</p>
<h2 id="开发问题"><a aria-hidden="true" tabindex="-1" href="#开发问题"><span class="icon icon-link"></span></a>开发问题</h2>
<h3 id="在-nodejs-中发起http请求遇到-unable-to-verify-the-first-certificate错误"><a aria-hidden="true" tabindex="-1" href="#在-nodejs-中发起http请求遇到-unable-to-verify-the-first-certificate错误"><span class="icon icon-link"></span></a>在 Nodejs 中发起HTTP请求遇到 <code>unable to verify the first certificate</code>错误</h3>
<p>近期有用户反馈： 同一个API接口，在浏览器、安卓客户端、iOS客户端、小程序里都能正常调用，但是在Nodejs 中却遇到了  <code>unable to verify the first certificate</code> 错误。</p>
<p>经过一番研究，发现这是目标网站证书配置错误导致的问题，在Nodejs这一侧解决的方案也很简单，有两个方法：</p>
<ul>
<li>使用第三方包 <a href="https://www.npmjs.com/package/ssl-root-cas" rel="noopener nofollow" target="_blank">ssl-root-cas</a>: <code>require('https').globalAgent.options.ca = require('ssl-root-cas/latest').create()</code>  让 Nodejs 能正确校验网站证书</li>
<li>设置环境变量: <code>process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = 0</code> ，禁用 Nodejs 对 HTTPS 网站证书的校验。不推荐，有安全风险</li>
</ul>
<p>这个问题的根本原因在于网站的证书证书配置错误：证书信息不完整，一般是缺少中级证信息，而 Nodejs 会严格校验证书信息，导致了该错误。其他端不会出问题，则是因为他们会智能的尝试补全缺失的证书信息，反而惯坏了网站的配置管理员😒。</p>
<p>相关参考资料：</p>
<ul>
<li><a href="https://stackoverflow.com/questions/31673587/error-unable-to-verify-the-first-certificate-in-nodejs" rel="noopener nofollow" target="_blank">https://stackoverflow.com/questions/31673587/error-unable-to-verify-the-first-certificate-in-nodejs</a></li>
<li><a href="https://www.npmjs.com/package/ssl-root-cas" rel="noopener nofollow" target="_blank">https://www.npmjs.com/package/ssl-root-cas</a></li>
<li><a href="https://badssl.com" rel="noopener nofollow" target="_blank">https://badssl.com</a></li>
</ul>
<h3 id="一个npm包如何同时支持小程序和web"><a aria-hidden="true" tabindex="-1" href="#一个npm包如何同时支持小程序和web"><span class="icon icon-link"></span></a>一个NPM包如何同时支持小程序和Web</h3>
<p>如果你有一个UI组件包或者一个工具包想要在小程序和Web上都可以用上，这个包大部分代码共享，只有少部分代码针对特定平台编写，那如何通过一个NPM包同时支持Web呢？
小程序官方支持在NPM包中通过package.json的<code>miniprogram</code>字段来特别指定包在小程序中的入口文件所在的文件夹（注意，是文件夹而不是文件）,  与标准的 <code>main</code> 字段含义类似。这样我们可以这样来声明package.json, 并保证打包后的目录和声明的一样：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">	"name"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"my-fancy-packge"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6A737D">	// web 的入口</span></span>
<span class="line"><span style="color:#79B8FF">	"main"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"dist/index.js"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6A737D">	// 小程序入口，确保有文件 dist/miniapp/index.js</span></span>
<span class="line"><span style="color:#79B8FF">	"miniprogram"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"dist/miniapp"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">	"files"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"dist/**"</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">  ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>参考链接： <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html" rel="noopener nofollow" target="_blank">https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html</a></p>
<h2 id="工具分享"><a aria-hidden="true" tabindex="-1" href="#工具分享"><span class="icon icon-link"></span></a>工具分享</h2>
<h3 id="iringo-解锁完整的-apple功能和集成服务"><a aria-hidden="true" tabindex="-1" href="#iringo-解锁完整的-apple功能和集成服务"><span class="icon icon-link"></span></a>iRingo: 解锁完整的 Apple功能和集成服务</h3>
<p>苹果的服务和功能因为各种原因会在基于地理位置进行阉割, 使用该配置可绕过相关限制.</p>
<p>链接: <a href="https://github.com/VirgilClyne/iRingo" rel="noopener nofollow" target="_blank">iRingo: 解锁完整的 Apple功能和集成服务</a></p>
<h3 id="webpack-的替代工具"><a aria-hidden="true" tabindex="-1" href="#webpack-的替代工具"><span class="icon icon-link"></span></a>Webpack 的替代工具</h3>
<p>Webpack 是前端常用的构建工具, 功能强大、无所不能, 但其配置复杂、性能低下也常被人诟病, 下边推荐一些非主流的构建工具(其实都已经非常出名了)供你选择,  不同场景选择最适合的工具, 能大大提高你的工作效率.</p>
<ul>
<li><a href="https://parceljs.org/" rel="noopener nofollow" target="_blank">Parcel</a>(<a href="https://github.com/parcel-bundler/parcel" rel="noopener nofollow" target="_blank">GitHub</a>):  更符合直觉构建工具, 使用非常简单(甚至可以做到0配置).  可以用于打包 web 项目、JS库、electron应用、浏览器扩展等, 支持各种前端技术, 非常推荐</li>
<li><a href="https://rollupjs.org/guide/zh/" rel="noopener nofollow" target="_blank">rollup.js</a>(<a href="https://github.com/rollup/rollup" rel="noopener nofollow" target="_blank">GitHub</a>): 轻量级的构建工具, 也支持各种插件, 可用于替代Webpack, 更擅长打包各种库, 性能效率要比Webpack高很多. 最近新起的的构建工具<a href="https://vitejs.dev/" rel="noopener nofollow" target="_blank">Vite</a>就是基于 rollup 二次封装的.</li>
<li><a href="https://swc.rs/" rel="noopener nofollow" target="_blank">SWC</a>(<a href="https://github.com/swc-project/swc" rel="noopener nofollow" target="_blank">GitHub</a>): 使用 rust 语言 开发Javascript / Typescript 编译工具, 可用于替代 babel / typescript，编译速度是他们的几倍到几十倍. 上面 提到的 Parcel 的 js/ts 编译就是使用 swc</li>
<li><a href="https://esbuild.github.io/" rel="noopener nofollow" target="_blank">esbuild</a>(<a href="https://github.com/evanw/esbuild" rel="noopener nofollow" target="_blank">GitHub</a>): 使用 go 语言开发的 Javascript / Typescript 编译工具，功能与上面的 swc一样，编译速度也非常快。</li>
<li><a href="https://nx.dev/" rel="noopener nofollow" target="_blank">Nx</a> (<a href="https://github.com/nrwl/nx" rel="noopener nofollow" target="_blank">GitHub</a>):  高效快速的打包工具, 原生支持 monorepo, 我暂时还未深入了解</li>
</ul>
<h2 id="文章分享"><a aria-hidden="true" tabindex="-1" href="#文章分享"><span class="icon icon-link"></span></a>文章分享</h2>
<h3 id="against-3x-speed---抵制三倍速"><a aria-hidden="true" tabindex="-1" href="#against-3x-speed---抵制三倍速"><span class="icon icon-link"></span></a>Against 3X Speed - 抵制三倍速</h3>
<p>我觉得大家(现代人类)注意力越来越涣散, 3x速、快餐文化并不是啥好事,  什么东西都是浅尝辄止、浮于表面，很难长时间集中注意力，也很难专注的去做一件事。
3倍速听书，并不会提高你的学习速度，因为人脑需要时间去理解和记忆，3倍速也只会让你听到的东西变成短暂的记忆，很难被你吸收，最后变成过眼云烟。同样的，3倍速看剧也有同样的问题，更糟糕的是，3倍速会让人物的语气、背景乐变得诡异，也将进一步让你难以理解剧情（国产注水电视剧不在讨论之列，4x看国产剧都不过分）、降低看剧的体验。
如果你觉得3倍速、看电影解说、听别人讲书籍精华等等快餐式文化消费并没有让你收获更多，那不妨试试 静下来、慢下来，用正常的速度好好看一部剧、看一本书。看的数量、速度并不是我们应当追求的，看的质量才是最重要的。</p>
<p>原文:  <a href="https://perell.com/essay/against-3x-speed/" rel="noopener nofollow" target="_blank">Against 3X Speed - 抵制三倍速</a></p>
<h3 id="我们为什么仍然允许吸烟"><a aria-hidden="true" tabindex="-1" href="#我们为什么仍然允许吸烟"><span class="icon icon-link"></span></a>我们为什么仍然允许吸烟</h3>
<p>吸烟有害个人身体健康、容易上瘾，且危害社会公共卫生。如果当代有人发现了类似烟草的对身体有害且容易上瘾的产品，想在市场上销售，应当没有国家会允许。那为何我们没有禁止吸烟呢？主要有两个原因：</p>
<ol>
<li>经济原因：一方面，大部分国家会对香烟课以重税，香烟为国家带来巨额的财政收入；另一方面，因为吸烟有害身体健康，吸烟者会因吸烟而患上相关致命癌症，寿命会大大减少，也能为社会减少医疗、养老负担（虽然听起来很冷血，但却是事实）。基于上述原因，甚至有人调侃说吸烟的人才是真正的爱国者🤪</li>
<li>历史原因：吸烟有害健康是很晚才被发现的，那时候香烟已经在全球流行起来，形成了成熟的产业链，受众很多，贸然禁止吸烟会引起极大的社会问题。</li>
</ol>
<p>故，现代国家通过重税、限制吸烟场所、香烟包装盒写警示语或贴恐怖图片、禁止香烟广告等措施在逐步限制抽烟。</p>
<p>原文: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4631133/" rel="noopener nofollow" target="_blank">美国卫生研究所: Why do we still permit tobacco use?</a></p>
<h2 id="影音分享"><a aria-hidden="true" tabindex="-1" href="#影音分享"><span class="icon icon-link"></span></a>影音分享</h2>
<ul>
<li>音乐: <strong>Study Music Project</strong> 系列, 目前共有一百多首曲子, 该系列是由华裔音乐家 <em>Dennis Kuo</em> 创作的一系列轻音乐, 非常适合舒缓放松心情. 收听地址: <a href="https://i.y.qq.com/n2/m/share/details/taoge.html?hosteuin=owEsNK4l7Kni&#x26;id=8054496786&#x26;appversion=110005&#x26;ADTAG=wxfshare&#x26;appshare=iphone_wx" rel="noopener nofollow" target="_blank">QQ音乐</a>, <a href="https://y.music.163.com/m/playlist?app_version=8.6.45&#x26;id=5011309788&#x26;userid=1809975&#x26;creatorId=382957814" rel="noopener nofollow" target="_blank">网易云音乐</a>, <a href="https://music.apple.com/us/album/study-music-project-6-memory-palace/1378626219" rel="noopener nofollow" target="_blank">Apple Music</a>.  如果你想了解这个音乐家, 可以查看<a href="https://zhuanlan.zhihu.com/p/52486242" rel="noopener nofollow" target="_blank">对他的专访</a></li>
<li>公开课: <a href="https://open.163.com/newview/movie/courseintro?newurl=M6GOB7TT6" rel="noopener nofollow" target="_blank">哈佛大学公开课：公正-该如何做是好？-网易公开课</a>,  这是一门入门级的政治哲学课程, 能让你对社会的公平正义有一定的认识. 该课程在全球备受好评, 讲师 Michael J. Sandel 的授课过程也非常的生动有趣. 课程上与学生互动很多, 他并不像传统课程那样照本宣科, 也没有给出任何官方、标准的见解, 而是通过不断的提问让学生进行思考、讨论, 所以整个课程是非常浅显易懂的.</li>
</ul> <div> <span class="mr-2 text-slate-400 text-sm">标签 </span> <a class=" bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-1 rounded-full" href="/tags/Nodejs/">Nodejs</a> </div> </article> <div class="px-4 max-w-4xl mx-auto relative"> <div class="relative flex justify-center py-4"><div class="absolute inset-x-0 top-1/2 h-px -translate-y-1/2 bg-transparent bg-gradient-to-r from-transparent via-gray-500 to-transparent opacity-75"></div><span class="relative z-1 bg-white px-6 dark:bg-slate-800">ஓ๑∗๑ஓ</span></div> <div class="flex justify-between mb-4 max-xs:flex-col max-xs:gap-4"> <div class="max-xs:flex max-xs:justify-between"> <a href="/2022/tech-issue-2.html" aria-label="Tech Issue #2" class="mr-4 hover-tip">
上一篇
</a> <a href="/2021/restart-blog-in-2021.html" aria-label="博客再次重启及优化" class="hover-tip">
下一篇
</a> </div> <div class="flex items-center gap-4 relative max-xs:justify-between"> <a href="#" class="hover-tip" aria-label="滚动到顶部"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-from-line"><path d="m18 9-6-6-6 6"></path><path d="M12 3v14"></path><path d="M5 21h14"></path></svg> </a> <a href="#disqus_thread" class="hover-tip" aria-label="评论"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-more"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path><path d="M8 12h.01"></path><path d="M12 12h.01"></path><path d="M16 12h.01"></path></svg> </a> <a href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fblog.evecalm.com%2F2021%2Ftech-issue-1.html" target="_blank" class="hover-tip" aria-label="分享到 Twitter"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-twitter"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.evecalm.com%2F2021%2Ftech-issue-1.html" target="_blank" class="hover-tip" aria-label="分享到 Facebook"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg> </a> </div> </div> <div id="disqus_thread" data-shortname="kalm" data-url="https://blog.evecalm.com/2021/tech-issue-1.html" data-identifier="2021/tech-issue-1.html"> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> <script defer>
  (function () {
    var d = window.document;
    function isNearBottom() {return window.innerHeight + window.scrollY >= d.body.scrollHeight - 400 }
    function onScroll() {
      if (!isNearBottom()) return;
      document.removeEventListener('scroll', onScroll);
      if (window.disqus_config) return;
      const r = document.getElementById('disqus_thread');
      window.disqus_config = function () {
        this.page.url = r.getAttribute('data-url');
        this.page.identifier = r.getAttribute('data-identifier');
      };
      var s = d.createElement('script');
      s.src = '//' + r.getAttribute('data-shortname') + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', Date.now());
      (d.head || d.body).appendChild(s);
    }
    if (isNearBottom()) { onScroll();return; }
    document.addEventListener('scroll', onScroll, { passive: true });
  })();
</script> </div>  <footer class="text-center text-slate-500 dark:text-slate-300 my-16"> <div>
Copyrights © 2024 Saiya. All Rights Reserved
</div> <div> <a href="https://evecalm.com" target="_blank" class="text-slate-500 dark:text-slate-300">夏影</a> &
<a href="https://forth.ink" target="_blank" class="text-slate-500 dark:text-slate-300">𝗳𝗼𝗿𝘁𝗵𝗶𝗻𝗸</a> </div> </footer> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-DPSKR82X8Z"></script> <script defer>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-DPSKR82X8Z');
</script> </body></html>  <script defer>
  document.body.querySelectorAll('article img').forEach((img) => {
    const title = img.getAttribute('title') || img.getAttribute('alt');
    if (!title) return;
    const figure = document.createElement('figure');
    img.parentNode.replaceChild(figure, img);
    figure.appendChild(img);
    img.insertAdjacentHTML(
      'afterend',
      `<figcaption class="text-center italic">${title}</figcaption>`
    );
  });
</script>