---
import { DISQUS_SHORTNAME } from '@/config';
---

<div
  id="disqus_thread"
  data-shortname={DISQUS_SHORTNAME}
  data-url={Astro.url.href}
  data-identifier={Astro.url.pathname.replace('/', '')}
>
  <noscript
    >Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript"
      >comments powered by Disqus.</a
    ></noscript
  >
</div>
<script defer is:inline>
  (function () {
    function onScroll () {
      var d = window.document
      if (d.body.scrollHeight - window.innerHeight - window.scrollY > 400) return
      document.removeEventListener('scroll', onScroll);
      if (window.disqus_config) return;
      const r = document.getElementById('disqus_thread');
      window.disqus_config = function () {
        this.page.url = r.getAttribute('data-url');
        this.page.identifier = r.getAttribute('data-identifier');
      };
      var s = d.createElement('script');
      s.src = '//' + r.getAttribute('data-shortname') + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', Date.now());
      (d.head || d.body).appendChild(s);
    }
    document.addEventListener('scroll', onScroll, { passive: true });
  })();
</script>
