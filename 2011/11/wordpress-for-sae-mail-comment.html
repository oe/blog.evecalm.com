<!DOCTYPE html><html lang="zh-Hans" class="scroll-smooth"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.png" type="image/png"><title>[建站]Wordpress for 新浪SAE 免插件实现评论邮件提醒 - 夏影の博客</title><link rel="alternate" type="application/rss+xml" title="夏影の博客" href="https://blog.evecalm.com/atom.xml"><meta name="description" content="新浪SAE可以比较好的运行wordpress，但是由于它不同于一般主机，功能上有些限制，比如不能在wordpress后台直接修改主题代码，不支持wordpress默认的邮件函数，而，官方给出的解释都是出于安全原因。 对于在线修改wordpress主题及其他代码，可以登录SAE后进入相关应用打开代码管理，即可在线修改所有的代码。对于邮件功能，wordpress for SAE 里有一个WP-Mail..."><meta property="og:type" content="blog"><meta property="og:title" content="[建站]Wordpress for 新浪SAE 免插件实现评论邮件提醒"><meta property="og:url" content="https://blog.evecalm.com/2011/11/wordpress-for-sae-mail-comment.html"><meta property="og:site_name" content="夏影の博客"><meta property="og:local" content="zh-Hans"><meta property="og:description" content="新浪SAE可以比较好的运行wordpress，但是由于它不同于一般主机，功能上有些限制，比如不能在wordpress后台直接修改主题代码，不支持wordpress默认的邮件函数，而，官方给出的解释都是出于安全原因。 对于在线修改wordpress主题及其他代码，可以登录SAE后进入相关应用打开代码管理，即可在线修改所有的代码。对于邮件功能，wordpress for SAE 里有一个WP-Mail..."><meta property="og:image" content="//evecalm.com/assets/avatar.jpg"><meta property="article:author" content="Saiya"><link rel="canonical" href="https://blog.evecalm.com/2011/11/wordpress-for-sae-mail-comment.html"><link rel="stylesheet" href="/_astro/_pageList_.rVnnU10n.css">
<style>@charset "UTF-8";article h1,article h2,article h3,article h4,article h5,article h6{position:relative}article h1 .icon-link,article h2 .icon-link,article h3 .icon-link,article h4 .icon-link,article h5 .icon-link,article h6 .icon-link{position:absolute;left:-1em;opacity:0}article h1 .icon-link:after,article h2 .icon-link:after,article h3 .icon-link:after,article h4 .icon-link:after,article h5 .icon-link:after,article h6 .icon-link:after{content:"🔗";font-size:.6em}article h1:hover .icon-link,article h2:hover .icon-link,article h3:hover .icon-link,article h4:hover .icon-link,article h5:hover .icon-link,article h6:hover .icon-link{opacity:1}.post-title{margin-bottom:.2em}
.hover-tip{position:relative;&:before{content:attr(aria-label);position:absolute;bottom:120%;left:50%;width:-moz-max-content;width:max-content;transform:translate(-50%);padding:.5rem;background-color:#333;color:#ddd;border-radius:.25rem;box-shadow:0 0 .5rem #0000001a;z-index:10;display:none}&.bottom:before{top:120%;bottom:auto}&:hover:before{display:block}}
</style></head> <body class="bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-300 font-sans text-wrap break-words relative"> <div class="border-b border-slate-100 dark:border-slate-700 mb-4"> <header class="max-w-4xl flex justify-between items-center m-auto py-6 px-4 font-serif text-slate-500 dark:text-slate-400 max-xs:flex-col max-xs:gap-2"> <h1 class="text-xl"> <a href="/">夏影の博客</a> </h1> <ul class="flex gap-4"> <li> <a href="/tags/">分类</a> </li> <li> <a href="/categories/">标签</a> </li> <li> <a href="https://evecalm.com/about" target="_blank">关于</a> </li> <li> <a href="/atom.xml" target="_blank" aria-label="RSS 订阅" class="hover-tip bottom"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg> </a> </li> <li> <a href="https://github.com/oe" target="_blank" aria-label="Github 账户" class="hover-tip bottom"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> </a> </li> </ul> </header> </div>   <article class="format lg:format-lg max-w-4xl prose-zinc dark:format-invert mx-auto px-4 mb-4"> <h1 class="post-title">[建站]Wordpress for 新浪SAE 免插件实现评论邮件提醒</h1> <div class="text-slate-400 text-sm mb-2">2011年11月28日<!-- -->发布在 <a href="/categories/%E5%BB%BA%E7%AB%99/">建站</a></div> <p>新浪SAE可以比较好的运行wordpress，但是由于它不同于一般主机，功能上有些限制，比如不能在wordpress后台直接修改主题代码，不支持wordpress默认的邮件函数，而，官方给出的解释都是出于安全原因。</p>
<p>对于在线修改wordpress主题及其他代码，可以登录SAE后进入相关应用打开代码管理，即可在线修改所有的代码。对于邮件功能，wordpress for SAE 里有一个WP-Mail-SMTP插件，但是其功能差强人意，并不能实现评论邮件提醒访客，只能提醒站长。而SAE本身就封装了一个邮件函数，使用该函数的范例代码如下</p>
<blockquote>
<p>最大可发送1MB大小的邮件（含附件</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>&#x3C;?ph</p>
</blockquote>
<blockquote>
<p>$mail = new SaeMail()</p>
</blockquote>
<blockquote>
<p>$mail->setAttach( array( ‘my_photo’ => ‘照片的二进制数据’ ) )</p>
</blockquote>
<blockquote>
<p>$ret = $mail->quickSend( ‘<a href="mailto:to@sina.cn">to@sina.cn</a>’ , ‘邮件标题’ , ‘邮件内容’ , ‘<a href="mailto:smtpaccount@gmail.com">smtpaccount@gmail.com</a>’ , ‘password’ )</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>//发送失败时输出错误码和错误信</p>
</blockquote>
<blockquote>
<p>if ($ret === false</p>
</blockquote>
<blockquote>
<p>var_dump($mail->errno(), $mail->errmsg())</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>$mail->clean(); // 重用此对</p>
</blockquote>
<blockquote>
<p>$ret = $mail->quickSend( ‘<a href="mailto:to@sina.cn">to@sina.cn</a>’ , ‘邮件标题’ , ‘邮件内容’ , ‘<a href="mailto:smtpaccount@unknown.com">smtpaccount@unknown.com</a>’ , ‘password’ , ‘smtp.unknown.com’ , 25 ); // 指定smtp和端</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>//发送失败时输出错误码和错误信</p>
</blockquote>
<blockquote>
<p>if ($ret === false</p>
</blockquote>
<blockquote>
<p>var_dump($mail->errno(), $mail->errmsg())</p>
</blockquote>
<blockquote>
<p>?&#x26;gt</p>
</blockquote>
<blockquote>
<p>更多相关说明可以看[官方文档](<a href="http://apidoc.sinaapp.com/sae/SaeMail.html" rel="noopener nofollow" target="_blank">http://apidoc.sinaapp.com/sae/SaeMail.html</a></p>
</blockquote>
<p>如果你对php比较了解的话，完全可以参照以上代码为自己的Wordpress for SAE添加邮件评论提醒功能，否则的话，可以使用下面的代码(本站的邮件提醒即用以下代码实现的)</p>
<blockquote>
<p>//comment_mail_notify(所有的回复都会发邮件通知</p>
</blockquote>
<blockquote>
<p>function comment_mail_notify($comment_id)</p>
</blockquote>
<blockquote>
<p>$admin_email = get_bloginfo (‘admin_email’); // $admin_email 可改為你指定的 e-mail</p>
</blockquote>
<blockquote>
<p>$comment = get_comment($comment_id)</p>
</blockquote>
<blockquote>
<p>$comment_author_email = trim($comment->comment_author_email)</p>
</blockquote>
<blockquote>
<p>$parent_id = $comment->comment_parent ? $comment->comment_parent : ”</p>
</blockquote>
<blockquote>
<p>$to = $parent_id ? trim(get_comment($parent_id)->comment_author_email) : ”</p>
</blockquote>
<blockquote>
<p>$spam_confirmed = $comment->comment_approved</p>
</blockquote>
<blockquote>
<p>if (($parent_id != ”) &#x26;&#x26; ($spam_confirmed != ‘spam’) &#x26;&#x26; ($to != $admin_email)&#x26;&#x26;isset($_POST[‘comment_mail_notify’]))</p>
</blockquote>
<blockquote>
<p>/* 上面是判断是否发出邮件</p>
</blockquote>
<blockquote>
<p>($spam_confirmed != ‘spam’): 不给垃圾评论发送邮件提醒，必需!</p>
</blockquote>
<blockquote>
<p>($to != $admin_email) : 不发送邮件给站</p>
</blockquote>
<blockquote>
<p>($comment_author_email == $admin_email) : 只有站长评论时才发送邮件提</p>
</blockquote>
<blockquote>
<p>isset($_POST[‘comment_mail_notify’]) :接收邮件提醒的复选框被选中则发送邮</p>
</blockquote>
<blockquote>
<p>以上可视个人情况修</p>
</blockquote>
<blockquote>
<ul>
<li></li>
</ul>
</blockquote>
<blockquote>
<p>$wp_email = ‘你的邮箱地址’;// . preg_replace(’#^<a href="http://www.#" rel="noopener nofollow" target="_blank">www.#</a>’, ”, strtolower($_SERVER[‘SERVER_NAME’])); // e-mail 發出點, no-reply 可改為可用的 e-mail</p>
</blockquote>
<blockquote>
<p>$subject = ‘您在[’ . get_option(“blogname”) . ‘]的留言有新回复’</p>
</blockquote>
<blockquote>
<p>$message =</p>
</blockquote>
<blockquote>
<p>&#x3C;div style=“margin: 1em 40px 1em 40px;background-color:#eef2fa;border:1px solid #d8e3e8;color:#111;padding: 0 15px;-moz-border-radius:5px;-webkit-border-radius:5px;-khtml-border-radius:5px;border-radius:5px;“&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>’ . trim(get_comment($parent_id)->comment_author) . ‘，您好！&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>您在&#x3C;strong>《’ . get_the_title($comment->comment_post_ID) . ’》&#x3C;/strong>的留言：&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p> ’ . trim(get_comment($parent_id)->comment_content) . ’&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>&#x3C;strong>’ . trim($comment->comment_author) . ’&#x3C;/strong>给您的回复：&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p> ’ . trim($comment->comment_content) . ’&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>您可以点击&#x3C;a href=”’ . htmlspecialchars(get_comment_link($parent_id)) . ’“>查看完整的內容&#x3C;/a>&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>欢迎再度光临 &#x3C;a href=”’ . get_option(‘home’) . ’”>’ . get_option(‘blogname’) . ’&#x3C;/a>&#x3C;/p&#x26;gt</p>
</blockquote>
<blockquote>
<p>&#x3C;p>来自’ . get_option(‘blogname’) . ‘的诚挚问候.&#x3C;/p>&#x3C;/div&#x26;gt</p>
</blockquote>
<blockquote>
<p>’</p>
</blockquote>
<blockquote>
<p>$mail = new SaeMail()</p>
</blockquote>
<blockquote>
<p>$options = array(“from”=>$wp_email, “to”=>$to, “smtp_host”=>‘邮箱的smtp服务器地址’,“smtp_username”=>‘你的邮箱地址’,“smtp_password”=>‘邮箱密码’,“subject”=>$subject,“content”=>$message,“content_type”=>‘HTML’)</p>
</blockquote>
<blockquote>
<p>$ret=false</p>
</blockquote>
<blockquote>
<p>if($mail->setOpt($options)</p>
</blockquote>
<blockquote>
<p>$ret=$mail->send()</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>//发送失败时输出错误码和错误信</p>
</blockquote>
<blockquote>
<p>if ($ret === false</p>
</blockquote>
<blockquote>
<p>var_dump($mail->errno(), $mail->errmsg())</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>add_action(‘comment_post’, ‘comment_mail_notify’)</p>
</blockquote>
<blockquote>
<p>// — END ---------------------------------------</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>//在评论框下面添加一个复选框,由访客决定是否接收邮件提醒，默认选</p>
</blockquote>
<blockquote>
<p>function add_checkbox()</p>
</blockquote>
<blockquote>
<p>echo</p>
</blockquote>
<blockquote>
<p>&#x3C;input id=“comment_mail_notify” style=“margin-left: 20px;” type=“checkbox” name=“comment_mail_notify” value=“comment_mail_notify” checked=“true” />&#x3C;label for=“comment_mail_notify”>邮件通知对方&#x3C;/label>‘</p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>add_action(‘comment_form’, ‘add_checkbox’)</p>
</blockquote>
<p>以上代码转自<a href="http://hanolex.org/archives/420.html" rel="noopener nofollow" target="_blank">hanolex</a>，代码相关说明:</p>
<p>1、需要修改的地方有四处，“你的邮箱地址 ”（两处必须一致），“邮箱的smtp服务器地址”（需邮箱支持smtp，并已启用，smtp地址形如smtp.qq.com）和“邮箱密码</p>
<p> 2、如果想去掉复选框，可以删除最后七行代码，然后去掉以上代码第八行中的“&#x26;&#x26;isset($_POST[‘comment_mail_notify’])”</p>
<p>注意,请不要将以上代码与其他有类似功能的代码或者插件一起启用,会产生冲突导致功能失效.如果你确定要使用本代码,请删除相关代码,停用相关插件,并上传Clean Options插件，清理因启用相关插件而残留下来的信息。</p>
<p>祝你好运！如还有任何疑问，请<a href="#respond">留言</a>。</p>
<p>最后，再次劝告大家，SAE已经修改了云豆赠送规则，完全商业运营了，不再适合普通的小网站，而我在不久的将来也会再次搬家。不过，如果你是一个高级的程序开发者，那么你可以为新浪微博开发一款应用（最好是客户端应用），并申请新浪开发者认证，这样每个月都可以补足一万个豆豆，可以让你在SAE长久呆着，除非新浪再次修改规则。</p> <div> <span class="mr-2 text-slate-400 text-sm">标签 </span> <a class=" bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-1 rounded-full" href="/tags/%E4%B8%BB%E6%9C%BA/">主机</a><a class=" bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-1 rounded-full" href="/tags/%E7%BD%91%E7%AB%99/">网站</a><a class=" bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-1 rounded-full" href="/tags/%E9%82%AE%E4%BB%B6/">邮件</a> </div> </article> <div class="px-4 max-w-4xl mx-auto relative"> <div class="relative flex justify-center py-4"><div class="absolute inset-x-0 top-1/2 h-px -translate-y-1/2 bg-transparent bg-gradient-to-r from-transparent via-gray-500 to-transparent opacity-75"></div><span class="relative z-1 bg-white px-6 dark:bg-slate-800">ஓ๑∗๑ஓ</span></div> <div class="flex justify-between mb-4 max-xs:flex-col max-xs:gap-4"> <div class="max-xs:flex max-xs:justify-between"> <a href="/2011/12/microblog-source-of-web.html" aria-label="[建站]自定义微博来源，巧用微博增加网站流量" class="mr-4 hover-tip">
上一篇
</a> <a href="/2011/11/sous-les-branches.html" aria-label="[音乐]梦的朵雅-《Sous Les Branches》" class="hover-tip">
下一篇
</a> </div> <div class="flex items-center gap-4 relative max-xs:justify-between"> <a href="#" class="hover-tip" aria-label="滚动到顶部"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-from-line"><path d="m18 9-6-6-6 6"></path><path d="M12 3v14"></path><path d="M5 21h14"></path></svg> </a> <a href="#disqus_thread" class="hover-tip" aria-label="评论"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-more"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path><path d="M8 12h.01"></path><path d="M12 12h.01"></path><path d="M16 12h.01"></path></svg> </a> <a href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fblog.evecalm.com%2F2011%2F11%2Fwordpress-for-sae-mail-comment.html" target="_blank" class="hover-tip" aria-label="分享到 Twitter"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-twitter"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.evecalm.com%2F2011%2F11%2Fwordpress-for-sae-mail-comment.html" target="_blank" class="hover-tip" aria-label="分享到 Facebook"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg> </a> </div> </div> <div id="disqus_thread" data-shortname="kalm" data-url="https://blog.evecalm.com/2011/11/wordpress-for-sae-mail-comment.html" data-identifier="2011/11/wordpress-for-sae-mail-comment.html"> <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> <script defer>
  (function () {
    var d = window.document;
    function isNearBottom() {return window.innerHeight + window.scrollY >= d.body.scrollHeight - 400 }
    function onScroll() {
      if (!isNearBottom()) return;
      document.removeEventListener('scroll', onScroll);
      if (window.disqus_config) return;
      const r = document.getElementById('disqus_thread');
      window.disqus_config = function () {
        this.page.url = r.getAttribute('data-url');
        this.page.identifier = r.getAttribute('data-identifier');
      };
      var s = d.createElement('script');
      s.src = '//' + r.getAttribute('data-shortname') + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', Date.now());
      (d.head || d.body).appendChild(s);
    }
    if (isNearBottom()) { onScroll();return; }
    document.addEventListener('scroll', onScroll, { passive: true });
  })();
</script> </div>  <footer class="text-center text-slate-500 dark:text-slate-300 my-16"> <div>
Copyrights © 2024 Saiya. All Rights Reserved
</div> <div> <a href="https://evecalm.com" target="_blank" class="text-slate-500 dark:text-slate-300">夏影</a> &
<a href="https://forth.ink" target="_blank" class="text-slate-500 dark:text-slate-300">𝗳𝗼𝗿𝘁𝗵𝗶𝗻𝗸</a> </div> </footer> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-DPSKR82X8Z"></script> <script defer>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-DPSKR82X8Z');
</script> </body></html>  <script defer>
  document.body.querySelectorAll('article img').forEach((img) => {
    const title = img.getAttribute('title') || img.getAttribute('alt');
    if (!title) return;
    const figure = document.createElement('figure');
    img.parentNode.replaceChild(figure, img);
    figure.appendChild(img);
    img.insertAdjacentHTML(
      'afterend',
      `<figcaption class="text-center italic">${title}</figcaption>`
    );
  });
</script>